<?xml version="1.0" encoding="utf-8"?>
<le:action xmlns:le="http://www.sylma.org/execution" xmlns:li="http://www.sylma.org/interface" xmlns:la="http://www.sylma.org/processors/action-builder" xmlns="http://www.w3.org/1999/xhtml">
  <le:settings>
    <le:name>Mozaic</le:name>
    <le:argument required="false" format="php-string" name="path" allow-empty="true">
      <le:validate return="true">
        <le:controler>
          <li:get-directory>
            <le:get-argument name="path"/>
          </li:get-directory>
        </le:controler>
      </le:validate>
      <le:default required="false">
        <le:user>
          <li:get-directory/>
        </le:user>
      </le:default>
    </le:argument>
    <le:processor path="/sylma/processors/action-builder" namespace="http://www.sylma.org/processors/action-builder"/>
    <le:get-argument name="path">
      <li:if>
        <le:get-argument name="path">
          <li:get-parent set-variable="parent"/>
        </le:get-argument>
      </li:if>
      <li:if-not>
        <le:controler>
          <li:get-directory set-variable="parent"/>
        </le:controler>
      </li:if-not>
    </le:get-argument>
  </le:settings>
  <la:layer name="mozaic" extend-base="sylma.explorer-classes" class="mozaic">
    <la:property name="sylma-send-method">get</la:property>
    <la:property name="parentDirectory">
      <le:string>
        <le:get-variable name="parent"/>
      </le:string>
    </la:property>
    <la:property name="currentDirectory">
      <le:string>
        <le:get-argument name="path"/>
      </le:string>
    </la:property>
    <div class="clearfix">
      <la:event name="click" limit="self"><![CDATA[%ref-object%.rootObject.tools.hide();
return true;]]></la:event>
      <div>
        <a href="#">
          <la:event name="click"><![CDATA[$('explorer-messages').getChildren().fade('in').setStyle('height', 'auto');
return false;]]></la:event>
          <span>SM</span>
        </a>
        <a href="#">
          <la:event name="click"><![CDATA[var layer = %ref-object%;

sylma.explorer.tools.reset();
var path = layer.parentDirectory ? layer.parentDirectory : '/';

layer.update({'path' : path});

return false;

]]></la:event>
          <img src="[$sylma-directory]/../directory-up.png"/>
        </a>
        <span>
          <le:string>
            <le:get-argument name="path"/>
          </le:string>
        </span>
      </div>
      <le:get-argument return="false" name="path">
        <li:browse>
          <le:array/>
          <le:array>.svn,.sml</le:array>
          <le:integer>1</le:integer>
          <li:get-document>
            <li:parse>
              <le:document class="xsl">
                <la:replace-events>
                  <le:template path="index.xsl">
                    <li:include-externals/>
                  </le:template>
                </la:replace-events>
                <li:set-parameter>
                  <le:argument>directory</le:argument>
                  <le:string>
                    <le:parent-directory/>
                  </le:string>
                </li:set-parameter>
              </le:document>
            </li:parse>
          </li:get-document>
        </li:browse>
      </le:get-argument>
    </div>
  </la:layer>
</le:action>
