<?xml version="1.0" encoding="utf-8"?>
<tst:tests
  xmlns:tst="http://www.sylma.org/parser/action/test/standalone"
  xmlns="http://www.sylma.org"
  xmlns:html="http://www.w3.org/1999/xhtml"
  xmlns:le="http://www.sylma.org/parser/action"
  xmlns:li="http://www.sylma.org/parser/caller"
  xmlns:lm="http://www.sylma.org/parser/action/basic"
>
  <tst:description>Basic</tst:description>
  <tst:test name="Simple text creation">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/read'));
    </tst:prepare>
    <tst:expected>
      $action = $controler->getArgument('action');
      return $action->asString() === '123';
    </tst:expected>
  </tst:test>
  <tst:test name="Call another action in text">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/call-text'));
    </tst:prepare>
    <tst:expected>
      $action = $controler->getArgument('action');

      return
        $action->asString() === '123';
    </tst:expected>
  </tst:test>
  <tst:test name="Call action in dom">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/call-dom'));
    </tst:prepare>
    <tst:node>
      <div xmlns="http://www.sylma.org">abc</div>
    </tst:node>
    <tst:expected>
      $action = $controler->getArgument('action');
      $node = $controler->getArgument('node');

      return
        $controler->compareNodes($action->asDOM(), $node);
    </tst:expected>
  </tst:test>
  <tst:test name="Call script">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/call-script'));
    </tst:prepare>
    <tst:node>
      <div xmlns="http://www.sylma.org">
        <ul>
          <li>admin</li>
          <li>admin@sylma.org</li>
        </ul>
      </div>
    </tst:node>
    <tst:expected>
      $action = $controler->getArgument('action');
      $node = $controler->getArgument('node');

      return
        $controler->compareNodes($action->asDOM(), $node);
    </tst:expected>
  </tst:test>
  <tst:test name="Get script return" disabled="true">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/call-script-return'));
    </tst:prepare>
    <tst:expected>
      $action = $controler->getArgument('action');

      return
        $action->asString() === '123';
    </tst:expected>
  </tst:test>
  <tst:test name="Multiple nodes">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/multi-node'));
    </tst:prepare>
    <tst:node>
      <div xmlns="http://www.sylma.org"><h1>Titre</h1><p><div xmlns="http://www.sylma.org">abc</div></p><p><div>Hello world</div><ul><li>item 1</li><li>item 2</li></ul></p></div>
    </tst:node>
    <tst:expected>
      $action = $controler->getArgument('action');
      $node = $controler->getArgument('node');

      return
        $controler->compareNodes($action->asDOM(), $node);
    </tst:expected>
  </tst:test>
  <tst:test name="Node as argument" disabled="true">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/node-arg'));
    </tst:prepare>
    <tst:node>

    </tst:node>
    <tst:expected>
      $action = $controler->getArgument('action');
      $node = $controler->getArgument('node');

      return
        $controler->compareNodes($action->asDOM(), $node);
    </tst:expected>
  </tst:test>
  <tst:test name="Action as argument">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/backend'));
      $controler->setArgument('content', $controler->getAction('samples/div'));
    </tst:prepare>
    <tst:node>
      <html xmlns="http://www.w3.org/1999/xhtml"><head></head><body><div id="content"><div xmlns="http://www.sylma.org">abc</div></div></body></html>
    </tst:node>
    <tst:expected>
      $action = $controler->getArgument('action');
      $action->setArgument('content', $controler->getArgument('content'));

      $node = $controler->getArgument('node');

      return
        $controler->compareNodes($action->asDOM(), $node);
    </tst:expected>
  </tst:test>
  <tst:test name="Sub-action without root">
    <tst:prepare>
      $controler->setArgument('action', $controler->getAction('samples/backend'));
      $controler->setArgument('content', $controler->getAction('samples/no-root'));
    </tst:prepare>
    <tst:node>
      <html xmlns="http://www.w3.org/1999/xhtml"><head></head><body><div id="content"><h1>Titre</h1><p>Hello world</p></div></body></html>
    </tst:node>
    <tst:expected>
      $action = $controler->getArgument('action');
      $action->setArgument('content', $controler->getArgument('content'));

      $node = $controler->getArgument('node');

      return
        $controler->compareNodes($action->asDOM(), $node);
    </tst:expected>
  </tst:test>
</tst:tests>