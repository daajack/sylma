<?xml version="1.0" encoding="utf-8"?>
<tst:tests xmlns:tst="http://www.sylma.org/core/settings/test" xmlns="http://www.sylma.org" xmlns:html="http://www.w3.org/1999/xhtml">
  <tst:description>XArguments</tst:description>
  <tst:test name="Construction with an array">
    <tst:prepare>
      return new XArguments(
        array(
          'abc' => 123,
          'def' => '456',
        )
      );
    </tst:prepare>
    <tst:expected>
      return
        $args->get('abc') === 123 &amp;&amp;
        $args->get('def') === '456'
    </tst:expected>
  </tst:test>
  <tst:test name="Construction with a file">
    <tst:prepare>return new XArguments($sDirectory . '/simple.yml');</tst:prepare>
    <tst:expected>
      return
        $args->get('abc') === 123 &amp;&amp;
        $args->get('def') === '456'
    </tst:expected>
  </tst:test>
  <tst:test name="Import with relative path">
    <tst:prepare>return new XArguments($sDirectory . '/import-relative.yml');</tst:prepare>
    <tst:expected>
      return
        $args->get('ghi') === 789 &amp;&amp;
        $args->get('jkl/abc') === 123 &amp;&amp;
        $args->get('jkl/def') === '456'
      </tst:expected>
  </tst:test>
  <tst:test name="Import with absolute path">
    <tst:prepare>
      return new XArguments(array(
        'ghi' => 789,
        'jkl' => '@sylma:import /sylma/core/settings/test/simple.yml;',
      ));
    </tst:prepare>
    <tst:expected>
      return
        $args->get('ghi') === 789 &amp;&amp;
        $args->get('jkl/abc') === 123 &amp;&amp;
        $args->get('jkl/def') === '456'
      </tst:expected>
  </tst:test>
  <tst:test name="Self reference">
    <tst:prepare>
      return new XArguments(array(
        'abc' => 123,
        'def' => '@sylma:self ../abc;',
      ));
    </tst:prepare>
    <tst:expected>
      return
        $args->get('def') === 123
    </tst:expected>
  </tst:test>
  <tst:test name="Import's merge">
    <tst:prepare>
      $arg1 = new XArguments(array(
        'abc' => "@sylma:import $sDirectory/simple.yml;",
      ));
      $arg2 = new XArguments(array(
        'abc' => "@sylma:import $sDirectory/simple2.yml;",
      ));
      
      $arg1->merge($arg2);
      return $arg1;
    </tst:prepare>
    <tst:expected>
      return
        $args->get('abc/alpha') === 'red' &amp;&amp;
        $args->get('abc/beta') === 10
      </tst:expected>
  </tst:test>
  <tst:test name="Import, get and merge">
    <tst:prepare>
      $arg1 = new XArguments(array(
        'abc' => "@sylma:import $sDirectory/simple.yml;",
      ));
      $arg2 = new XArguments(array(
        'abc' => "@sylma:import $sDirectory/simple2.yml;",
      ));
      $arg1->get('abc'); // will resolve token
      $arg1->merge($arg2);
      return $arg1;
    </tst:prepare>
    <tst:expected>
      return
        $args->get('abc/alpha') === 'red' &amp;&amp;
        $args->get('abc/beta') === 10
      </tst:expected>
  </tst:test>
  <tst:test name="Import with absolute path and self reference">
    <tst:prepare>
      return new XArguments(array(
        'directory' => $sDirectory,
        'jkl' => 789,
        'mno' => '@sylma:import @sylma:self /directory; + /simple.yml;',
      ));
    </tst:prepare>
    <tst:expected>
      return
        $args->get('jkl') === 789 &amp;&amp;
        $args->get('mno/abc') === 123 &amp;&amp;
        $args->get('mno/def') === '456'
      </tst:expected>
  </tst:test>
</tst:tests>

